<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>High-Performance RAG Chatbot</title>
    <link rel="stylesheet" href="/static/styles.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&display=swap" rel="stylesheet">
</head>

<body>
    <div class="app-container">
        <!-- Sidebar for Sources -->
        <aside class="sidebar">
            <div class="sidebar-header">
                <h2>Knowledge Base</h2>
            </div>

            <div class="input-panel scrape-panel">
                <h3>Scrape URL</h3>
                <div class="input-wrapper-row">
                    <input type="url" id="url-input" placeholder="https://example.com" aria-label="URL to scrape">
                    <button id="scrape-btn" class="primary-btn">Add</button>
                </div>
            </div>

            <div class="input-panel upload-panel">
                <h3>Upload Document</h3>
                <div class="drop-zone" id="drop-zone">
                    <div class="drop-zone-content">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                            stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="upload-icon">
                            <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                            <polyline points="17 8 12 3 7 8"></polyline>
                            <line x1="12" y1="3" x2="12" y2="15"></line>
                        </svg>
                        <p id="drop-text">Drag & drop files here<br><span>or click to browse</span></p>
                    </div>
                    <input type="file" id="file-input" accept=".pdf,.docx,.csv,.txt,.md">
                </div>
            </div>

            <div class="sources-panel">
                <div class="sources-header-row">
                    <h3>Active Sources</h3>
                    <div style="display:flex; gap: 8px;">
                        <button id="view-db-btn" class="icon-btn" title="View Database">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <ellipse cx="12" cy="5" rx="9" ry="3"></ellipse>
                                <path d="M21 12c0 1.66-4 3-9 3s-9-1.34-9-3"></path>
                                <path d="M3 5v14c0 1.66 4 3 9 3s9-1.34 9-3V5"></path>
                            </svg>
                        </button>
                        <button id="clear-sources-btn" class="icon-btn" title="Clear all sources">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <polyline points="3 6 5 6 21 6"></polyline>
                                <path
                                    d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2">
                                </path>
                                <line x1="10" y1="11" x2="10" y2="17"></line>
                                <line x1="14" y1="11" x2="14" y2="17"></line>
                            </svg>
                        </button>
                    </div>
                </div>
                <ul id="sources-list" class="styled-list">
                    <!-- Added sources go here -->
                </ul>
            </div>
        </aside>

        <!-- Main Chat Interface -->
        <main class="chat-container">
            <header class="chat-header">
                <div class="flex-center">
                    <h1>RAG Assistant</h1>
                    <span class="badge">llama3.2:1b</span>
                </div>
                <button id="clear-chat-btn" class="icon-btn" title="Clear chat history">
                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
                        stroke-linecap="round" stroke-linejoin="round">
                        <path d="M3 6h18"></path>
                        <path d="M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6"></path>
                        <path d="M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2"></path>
                        <line x1="10" y1="11" x2="10" y2="17"></line>
                        <line x1="14" y1="11" x2="14" y2="17"></line>
                    </svg>
                </button>
            </header>

            <div class="chat-messages" id="chat-messages">
                <!-- Initial Welcome Message -->
                <div class="message bot">
                    <div class="avatar bot-avatar">ðŸ¤–</div>
                    <div class="bubble bot-bubble">
                        Hello! I'm your local RAG chatbot powered by Ollama and ChromaDB. Please add some knowledge
                        sources in the sidebar and ask me anything!
                    </div>
                </div>
            </div>

            <div class="chat-input-area">
                <div class="chat-input-wrapper">
                    <textarea id="chat-input" placeholder="Message RAG Assistant..." rows="1"
                        aria-label="Chat input"></textarea>
                    <button id="send-btn" class="send-btn" aria-label="Send message">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                            stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <line x1="22" y1="2" x2="11" y2="13"></line>
                            <polygon points="22 2 15 22 11 13 2 9 22 2"></polygon>
                        </svg>
                    </button>
                </div>
                <div class="footer-note">AI can make mistakes. Verify important information.</div>
            </div>
        </main>
    </div>

    <!-- View Database Modal -->
    <div id="db-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Database Contents (<span id="db-count">0</span>)</h2>
                <button id="close-db-modal" class="icon-btn" title="Close">&times;</button>
            </div>
            <div class="modal-body">
                <div id="db-content-area" class="db-content-area">
                    <p style="text-align: center; color: #a1a1aa; padding: 20px;">Loading...</p>
                </div>
            </div>
        </div>
    </div>

    <script src="/static/app.js"></script>
</body>

</html>